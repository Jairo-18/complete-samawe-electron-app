<form [formGroup]="form" class="w-full mt-3">
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Buscar pasadía</mat-label>
    <input
      matInput
      formControlName="excursionName"
      [matAutocomplete]="auto"
      placeholder="Paseo cascada..."
      (focus)="onExcursionFocus()"
    />
    <mat-icon matPrefix>tour</mat-icon>

    <!-- Botón para limpiar -->
    <button
      *ngIf="
        form.get('excursionName')?.enabled &&
        form.get('excursionName')?.value &&
        !isLoadingExcursions
      "
      matSuffix
      mat-icon-button
      type="button"
      (click)="clearExcursionSelection()"
      matTooltip="Limpiar selección"
    >
      <mat-icon>clear</mat-icon>
    </button>

    <mat-autocomplete
      #auto="matAutocomplete"
      (optionSelected)="onExcursionSelected($event.option.value)"
    >
      <mat-option
        *ngFor="let excursion of filteredExcursions"
        [value]="excursion.name"
      >
        {{ excursion.name }}
        <span
          [ngClass]="{
            'text-green-600': excursion.stateType?.name === 'Disponible',
            'text-yellow-600': excursion.stateType?.name === 'Mantenimiento',
            'text-red-600': excursion.stateType?.name === 'Fuera de Servicio',
            'text-blue-600': excursion.stateType?.name === 'Ocupado'
          }"
        >
          - {{ excursion.stateType?.name }}
        </span>
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <div class="flex flex-col md:flex-row gap-0 md:gap-2">
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Precio</mat-label>
      <input matInput formControlName="priceSale" [readonly]="true" />
      <mat-icon matSuffix>attach_money</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Cantidad</mat-label>
      <input
        matInput
        type="number"
        formControlName="amount"
        appCurrencyFormat
        class="text-right"
      />
      <mat-icon matSuffix>numbers</mat-icon>
    </mat-form-field>
  </div>

  <div class="flex flex-col md:flex-row gap-0 md:gap-2">
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Fecha y hora de entrada</mat-label>
      <input matInput type="datetime-local" formControlName="startDate" />
      <mat-icon matPrefix>event_available</mat-icon>
    </mat-form-field>
    <!-- 
    <app-date-picker
      [parentForm]="form"
      controlName="startDate"
      label="Selecciona fecha y hora"
      (valueChange)="form.get('startDate')?.setValue($event)"
    ></app-date-picker> -->

    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Fecha y hora de salida</mat-label>
      <input matInput type="datetime-local" formControlName="endDate" />
      <mat-icon matPrefix>event_busy</mat-icon>
    </mat-form-field>
  </div>

  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Tipo de impuesto</mat-label>
    <mat-select formControlName="taxeTypeId">
      <mat-option *ngFor="let taxe of taxeTypes" [value]="taxe.taxeTypeId">
        {{ taxe.name }}
      </mat-option>
    </mat-select>
    <mat-icon matPrefix>calculate</mat-icon>
  </mat-form-field>

  <button
    class="!w-full !rounded-lg"
    mat-fab
    extended="true"
    [disabled]="isLoading"
    (click)="addExcursion()"
  >
    <ng-container *ngIf="!isLoading; else loading">
      Añadir pasadía
    </ng-container>
    <ng-template #loading>
      <mat-spinner diameter="24" color="accent"></mat-spinner>
    </ng-template>
  </button>
</form>
